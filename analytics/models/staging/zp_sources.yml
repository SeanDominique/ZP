version: 2.0

# TODO: remove quotations and change column names to all caps

sources:
  - name: zp
    database: ZOI_ANALYTICS_DB
    schema: DEV_SEAN
    tables:
      - name: dim_biomarkers
        description: "Where biomarker values are stored"
        columns:
          - name: Biomarker_ID
            description: "Primary key"
            tests:
              - unique
              - not_null

      - name: dim_clinicians
        columns:
          - name: CLINICIAN_ID
            description: "Primary key"
            tests:
              - unique
              - not_null
          - name: FULL_NAME
            tests:
              - not_null
              - string_is_not_empty

      - name: dim_disease_profiles
        columns:
          - name: DISEASE_PROFILE_ID
            tests:
              - unique
              - not_null
          - name: LAST_REVIEWED
            description: "Last time the disease profile was reviewed for clinical veracity."
            tests:
              - not_null
              - date_format_is_valid
          - name: NAME
            tests:
              - not_null
              - string_is_not_empty

      - name: dim_medical_devices
        columns:
          - name: MEDICAL_DEVICE_ID
            description: "Primary key"
            tests:
              - unique
              - not_null
          - name: NAME
            tests:
              - not_null
              - string_is_not_empty
          - name: LAST_SERVICED_DATE
            description: "Most recent date the medical device was checked/serviced."
            tests:
              - not_null
              - date_format_is_valid
          - name: PURCHASED_DATE
            description: "When the medical device was purchased."
            tests:
              - not_null
              - date_format_is_valid


      - name: dim_members
        description: "Patient/member information"
        columns:
          - name: Member_ID
            description: "Primary key"
            tests:
              - unique
              - not_null
          - name: Full_Name
            tests:
              - not_null
              - string_is_not_empty
          - name: Date_Registered
            tests:
              - not_null
              - date_format_is_valid

      - name: dim_research_studies
        description: "Research studies and their metadata"
        columns:
          - name: Research_Study_ID
            description: "Primary key"
            tests:
              - unique
              - not_null
          - name: URI
            description: "Link to the research paper or study"
            tests:
              - not_null
              - string_is_not_empty

      - name: fact_data_collected
        description: "Biomarker measurements collected during examinations"
        columns:
          - name: Data_Collected_ID
            description: "Primary key"
            tests:
              - unique
              - not_null
          - name: Biomarker_ID
            tests:
              - relationships:
                  to: source('zp', 'dim_biomarkers')
                  field: Biomarker_ID
                  severity: warn
          - name: Value
            description: "Measured biomarker value"
            tests:
              - not_null

      - name: fact_examinations
        description: "Patient examination records"
        columns:
          - name: Examination_ID
            description: "Primary key"
            tests:
              - unique
              - not_null
          - name: Member_ID
            tests:
              - relationships:
                  to: source('zp', 'dim_members')
                  field: Member_ID
          - name: Examination_Date
            tests:
              - not_null
              - date_format_is_valid

      - name: fact_research_results
        description: "Results from research studies with statistical boundaries"
        columns:
          - name: Research_Result_ID
            description: "Primary key"
            tests:
              - unique
              - not_null
          - name: Biomarker_ID
            tests:
              - relationships:
                  to: source('zp', 'dim_biomarkers')
                  field: Biomarker_ID
          - name: Upper_Limit
            description: "Upper statistical boundary for normal range"
            tests:
              - not_null
          - name: Lower_Limit
            description: "Lower statistical boundary for normal range"
            tests:
              - not_null
